<!DOCTYPE html>
<html class="mdc-typography">
<head>
    <title>Pair up for an anonymous chat</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="dist/scss.bundle.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <style>
        #center-pair {
            vertical-align: top;
        }
        .my-grid {
            --mdc-layout-grid-margin: 40px;
            --mdc-layout-grid-gutter: 16px;
        }
        .profile-picture {
            height: 128px;
            width: 128px;
        }
        .inline {
            display: inline-block;
        }

        .width-change {
            width: 35%;
        }
    </style>
    <script src="scripts/core.js"></script>
    <script>
        var selfState = -1; // -1 = Unknown; 0 = Looker; 1 = Listener
        var intervalID = -1;

        function startLookoutAs(state) {
            selfState = state;
            if (state == 0) {
                // Start as a LOOKER! :D
                var matched = function(listenerUID) {
                    // Matched :o
                    Firebase.chat.pairSelfLookerToListener(listenerUID, function(chatID) {
                        window.location.replace("/chat.html");
                    }, function() { });
                };

                Firebase.chat.startHuntAsLooker(matched, function() {
                    intervalID = window.setInterval(function() {
                        Firebase.chat.getOneListener(function(listenerUID) {
                            window.clearInterval(intervalID);
                            matched(listenerUID);
                        }, function() { });
                    }, 1000);
                })
            } else if (state == 1) {
                // Start as a LISTENER! :D
                var matched = function(lookerUID) {
                    // Matched :o
                    Firebase.chat.pairSelfListenerToLooker(lookerUID, function(chatID) {
                        window.location.replace("/chat.html");
                    }, function() { });
                };

                Firebase.chat.startHuntAsListener(matched, function() {
                    intervalID = window.setInterval(function() {
                        Firebase.chat.getOneLooker(function(lookerUID) {
                            window.clearInterval(intervalID);
                            matched(lookerUID);
                        }, function() { });
                    }, 1000);
                })
            }
        }
    </script>
</head>
<body class="body mdc-typography">
<aside class="mdc-persistent-drawer">
    <nav class="mdc-persistent-drawer__drawer">
        <header class="mdc-persistent-drawer__header">
            <div class="mdc-persistent-drawer__header-content">
                Header here
            </div>
        </header>
        <nav id="icon-with-text-demo" class="mdc-persistent-drawer__content mdc-list">
            <a class="mdc-list-item mdc-persistent-drawer--selected" href="#">
                <i class="material-icons mdc-list-item__start-detail" aria-hidden="true">inbox</i>Inbox
            </a>
            <a class="mdc-list-item" href="#">
                <i class="material-icons mdc-list-item__start-detail" aria-hidden="true">star</i>Star
            </a>
        </nav>
    </nav>
</aside>
<div class="content">
    <header class="top-bar mdc-toolbar mdc-toolbar--fixed mdc-elevation--z4">
        <div class="mdc-toolbar__row">
            <section class="mdc-toolbar__section mdc-toolbar__section--align-start">
                <button class="drawer-toggle material-icons mdc-toolbar__icon--menu">menu</button>
                <span class="mdc-toolbar__title">Haven</span>
            </section>
            <section class="mdc-toolbar__section mdc-toolbar__section--align-end" role="toolbar">
                <button class="login-button mdc-button" aria-label="Login">Login</button>
                <div class="user-area" style="display: none">
                    <div class="mdc-menu-anchor">
                        <button class="user-area-name mdc-button">User Name</button>
                        <div class="mdc-simple-menu">
                            <ul class="mdc-simple-menu__items mdc-list" role="menu" aria-hidden="true">
                                <li class="mdc-list-item" role="menuitem" tabindex="0">
                                    <button class="logout-button mdc-button">Log out</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </header>

    <center>
        <main class="main mdc-toolbar-fixed-adjust" id="center-pair">
            <br /> <br />
            <h2> I would like to... </h2>

            <div class="inline">
                <img src="images/profile_blank.png" class="profile-picture" />
                <br /> <br />
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" onclick="startLookoutAs(0)">
                    Talk out anonymously
                </button>
            </div>

            <div class="inline width-change">&nbsp;</div>

            <div class="inline">
                <img src="images/profile_blank.png" class="profile-picture" />
                <br /> <br />
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" onclick="startLookoutAs(1)">
                    Listen to someone
                </button>
            </div>
        </main>
    </center>

</div>
<script src="scripts/core.js"></script>
</body>
</html>
